path.data: data
path.logs: log

entry:
  - name: test_entry
    enabled: true
    router: default
    max_concurrency: 20000
    network:
      binding: 0.0.0.0:8000

router:
  - name: default
    default_flow: test

flow:
  - name: test
    filter:
#      - context_regex_replace:
#          context: "_ctx.request.path"
#          pattern: "^/"
#          to: "/cluster:"
#          when:
#            contains:
#              _ctx.request.path: /_search
      - set_response:
          body: '{"message":"hello world"}'
#      - context_regex_replace:
#          context: "_ctx.response.body"
#          pattern: "hello"
#          to: "big"
      - set_context:
          context:
            _ctx.request.uri: http://baidu.com
            _ctx.request.path: new_request_path
            _ctx.request.host: api.infinilabs.com
            _ctx.request.method: DELETE
            _ctx.request.body: "hello world"
            _ctx.request.body_json.explain: true
            _ctx.request.query_args.from: 100
            _ctx.request.header.ENV: dev
            _ctx.response.content_type: "application/json"
            _ctx.response.header.TIMES: 100
            _ctx.response.status: 419
#            _ctx.response.body: "new_body"
            _ctx.response.body_json.success: true
      - dump:
          request: true
          response: true

# TESTING
#  curl localhost:8000/abc/_search
#  curl localhost:8000/abc -d'{"message":"hello world"}'
