entry:
  - name: my_es_entry
    enabled: true
    router: my_router
    max_concurrency: 200000
    network:
      binding: 0.0.0.0:8000

flow:
  - name: default_flow
    filter:
      - context_filter: #try admin
          context: _ctx.request.user
          action: redirect_flow
          exclude:
            - cn-devops
          flow: admin_flow
      - context_filter:  #try readonly
          context: _ctx.request.user
          action: redirect_flow
          exclude:
            - cn-jamesyang
          flow: readonly_flow
      #go rest flow
      - echo:
          message: "access denied"
      - set_response:
          status: 403
          content_type: application/json
          body: '{"message":"access denied"}'
  - name: admin_flow
    filter:
      - echo:
          message: "hello admin"
  - name: readonly_flow
    filter:
      - echo:
          message: "hello readonly"
router:
  - name: my_router
    default_flow: default_flow

#curl -u "cn-jamesyang:pass" http://localhost:8000  #go readonly
#curl -u "cn-devops:pass" http://localhost:8000     #go admin
#curl -u "other-user:pass" http://localhost:8000    #403
#curl  http://localhost:8000                        #403