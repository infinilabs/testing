path.data: data
path.logs: log

entry:
  - name: primary-or-slave-entry
    enabled: true
    router: primary-router
    max_concurrency: 10000
    network:
      binding: 0.0.0.0:8000
    tls:
      enabled: false

flow:
  - name: primary-read-flow
    filter:
      - elasticsearch:
          elasticsearch: "primary"
          refresh:
            enabled: true
            interval: 30s
      - elasticsearch:
          when:
            equals:
              _ctx.response.status: 404
          elasticsearch: "slave"
          refresh:
            enabled: true
            interval: 30s

router:
  - name: primary-router
    default_flow: primary-read-flow
    rules:
      - method:
          - "GET"
          - "HEAD"
        pattern:
          - "/{any:*}"
        flow:
          - primary-read-flow
      - method:
          - "*"
        pattern:
          - "/_cat"
          - "/_sql"
          - "/_cluster"
          - "/_refresh"
          - "/_count"
          - "/_search"
          - "/_msearch"
          - "/_mget"
          - "/{any_index}/_eql/search"
          - "/{any_index}/_count"
          - "/{any_index}/_search"
          - "/{any_index}/_msearch"
          - "/{any_index}/_mget"
        flow:
          - primary-read-flow


elasticsearch:
  - name: primary
    enabled: true
    endpoints:
      - http://192.168.3.188:9206
    discovery:
      enabled: true
      interval: 60s
  - name: slave
    enabled: true
    endpoints:
      - http://192.168.3.188:9204
    discovery:
      enabled: true
      interval: 60s
