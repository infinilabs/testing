path.data: data
path.logs: log

path.configs: "sample-configs/domains"
configs.auto_reload: true

entry:
  - name: dns_entry
    enabled: true
    router: dns_router
    max_concurrency: 10000
    network:
      binding: 0.0.0.0:8000

flow:
  - name: dns-flow
    filter:
      - flow:
          ignore_undefined_flow: true
          context_flow:
            context: _ctx.request.host
            context_parse_pattern: (?P<uuid>^[0-9a-z_\-]+)\.
            flow_id_template: flow_$[[uuid]]
      - set_response:
          status: 503
          content_type: application/json
          body: '{"message":"invalid HOST"}'

router:
  - name: dns_router
    default_flow: dns-flow


#curl http://localhost:8000/ -H 'HOST: ae2d7509-4de0-5e51-1cce-3db44b4e3de5.baidu.com' -v
## add hosts: 127.0.0.1 ae2d7509-4de0-5e51-1cce-3db44b4e3de5.infinilabs.com
#  curl ae2d7509-4de0-5e51-1cce-3db44b4e3de5.infinilabs.com:8000